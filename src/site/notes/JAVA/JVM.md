---
{"dg-publish":true,"permalink":"/JAVA/JVM/","created":"2024-10-16T00:41:26.958+09:00"}
---

# Java Virtual Machine
- 자바를 실행하기 위한 가상 기계(컴퓨터)
- OS에 종속받지 않고 CPU가 Java를 인식, 실행할 수 있게 하는 가상 컴퓨터 [이미지 출처](https://kukim.tistory.com/24)![|500](https://i.imgur.com/H6zoKTi.png)
- Java 소스코드(원시코드(`*.java`))는 CPU가 인식하지 못하므로 기계어로 컴파일을 해줘야 한다.
	- `Java 소스 코드(*.java) → JVM이 인식할 수 있는 Bytecode(*.class) → binary code`
- Java compiler가 `.java`파일을 `.class`라는 Java bytecode로 변환한다.
	- JDK를 설치하면 bin에 존재하는 javac.exe이다.
	- `javac` 명령어로 `.java`파일에서 .class`파일을 생성한다.
- JVM이 OS가 Bytecode를 이해할 수 있도록 해석해 준다.
	- 따라서 Bytecode는 JVM 위에서 OS 상관 없이 실행된다.
	- `java` 명령어로 `.class`파일을 실행한다.
- binary code == 이진 코드  ⊂ 기계어 
	- CPU가 이해하는 언어는 binary code, 가상 머신이 이해하는 코드는 byte code 이다.
___
# JIT 컴파일(Just-In-Time compilation)
- 동적 번역(dynamic translation)
- JIT 컴파일러는 프로그램을 실제 실행하는 시점에 기계어로 번역하는 컴파일러이다.
- 인터프리터 방식의 단점을 보완하기 위해 도입되었다.
	- 소스코드를 실행할 때마다 해석해야 하므로 실행 속도가 느리고 소스 코드가 그대로 노출되므로 코드 보안에 취약하다.
	- 인터프리터 방식으로 실행하다가 적절한 시점에 바이트 코드 전체를 컴파일하여 기계어로 변경하고, 이후에는 더이상 인터프리팅 하지 않고 기계어로 직접 실행하는 방식이다.
- JIT가 컴파일 하는 과정은 바이트 코드를 인터프리팅하는 것보다 훨씬 오래 걸리므로 한번만 실행되는 코드라면 컴파일 하지 않고 안티프리팅 하는 것이 유리하다.
- 따라서 JIT 컴파일러를 사용하는 JVM들은 내부적으로 해당 메서드가 얼마나 자주 수행되는지 체크하고 일정 정도를 넣을 때에만 컴파일을 수행한다.
### 자바 컴파일러가 자바 프로그램 코드를 바이트 코드르 변환한 다음, 실제 바이트 코드르 릿ㄹ행하는 시점에 자바 가상 머신이 바이트 코드를 JIT 컴파일을 통해 기계어로 변환한다.
# JVM 구성요소
![|500](https://i.imgur.com/nYw5t2H.png)
### 클래스 로더(Class Loader)
- JVM 내로 `*.class`을 로드하고, 링크를 통해 배치하는 작업을 수행하는 모듈
- 런 타임 시 동적으로 클래스를 로드하고 jar 파일 내 저장된 클래스들을 JVM 위에 탑재한다.
- 클래스를 처음으로 참조할 때, 해당 클래스를 로드하고 링크하는 역할을 한다.
### 실행 엔진(Execution Engine)
- 클래스를 실행시키는 역할이다.
- 바이트 코드(`*.class`)를 JVM 내부에서 기계가 실행할 수 있는 형태로 변경한다.
- #### 인터프리터(Interpreter)
	- 자바 바이트 코드를 명령어 단위로 읽어서 실행한다.
	- 한 줄씩 수행하기 때문에 속도가 느리다.
- #### JIT 컴파일러(Just-in-Time)
	- 인터프리터 방식으로 실행하다가 적절한 시점에 바이트 코드 전체를 컴파일하여 기계어로 변경하고, 이후에는 더 이상 안티프리팅 하지 않고 기계어로 직접 실행하는 방식
- #### 가비지 콜렉터(Garbage collector)
	- 더이상 사용되지 않는 인스턴스를 찾아 메모리에서 삭제한다.
### 런타임 데이터 영역(Runtime Data Area)![|500](https://i.imgur.com/1yfZp3Q.png)
- 프로그램을 수행하기 위해 OS에서 할당받은 메모리 공간
- #### PC Register
	- Thread가 시작될 때 생성되며 ==생성될 때마다 생성되는 공간==으로, 스레드마다 하나씩 존재한다.
	- Thread가 어떤 부분을 어떤 명령으로 실행해야할지에 대한 기록을 하는 부분으로 현재 수행중인 JVM 명령의 주소를 갖는다.
- #### JVM stack
	- 프로그램 실행 과정에서 ==임시로 할당==되었다가 메서드를 빠져나가면 바로 소멸되는 특성의 데이터를 저장하기 위한 영역
	- 메서드를 호출할 때마다 생성되며 메서드가 종료되면 프레임 별로 삭제한다.
	- 메서드 안에서 사용되는 값들, 매개변수, 지역변수, 리턴 값 및 연산 시 일어나는 값들을 임시로 저장한다.
- #### Native method stack
	- 자바 프로그램이 컴파일되어 생성되는 바이트 코드가 아닌 ==실제 수행할 수 있는 기계어로 작성된 프로그램을 실행시키는 영역==
	- 자바가 아닌 언어에서 제공되는 메서드
	- Java Native Interface를 통해 바이트로 전환하여 저장한다.
- #### Method Area(Class area, Static area)
	- 클래스 정보를 처음 메모리 공간에 올릴 때 초기화되는 대상을 저장하기 위한 메모리 공간
	- ==멤버 변수==(멤버 변수 이름, 데이터 타입, 접근 제어자에 대하 정보), ==메서드==(메서드의 이름, 리턴타입, 매개변수, 접근 제어자에 대항 정보), ==타입==(class인지 interface인지의 여부 저장, type의  속성, 전체 이름, super 클래스의 전체 이름)
- #### Runtime Constant Pool
	- 스태틱 영역에 존재하는 별도의 관리영역
	- 상수 자료형을 저장하고, 중복을 막는 역할을 수행한다.
- #### Heap 영역                                        ![|500](https://i.imgur.com/9ukIp7C.png)
	- 객체를 저장하는 가상메모리 공간
	- new 연산자로 생성되는 객체와 배열을 저장
	- Class Area(Static Area)에 올라온 클래스들만 객체로 생성할 수 있다.
	- ##### Permanent Generation
		- 생성된 객체들 정보의 주소값이 저장된 공간
		- 클래스 로더에 의해 load되는 Class, Method 등에 대한 Meta 정보가 저장되는 영역이고 JVM에 의해 사용된다.
		- Reflection(객체를 통해 클래스의 정보를 분석하는 기법)을 사용하여 동적으로 클래스가 로딩되는 경우에 사용된다.
	- ##### New/Young 영역
		- 가바지 콜렉터에 의해 관리되는 영역
		- 생명 주기가 짧은 젊은 객체들을 대상으로 한다.
		- 여기서 일어나는 가비지 콜렉트를 Minor GC 라고 한다.
		- ###### Eden
			- 객체들이 최초로 생성되는 공간
		- ###### Survivor 0, 1 
			- Eden에서 참조되는 객체들이 저장되는 공간
		- Eden영역에 객체가 가득차게되면 첫번째 가비지 콜렉트가 발생한다. Eden 영역에 있는 값들을 Survivor 1 영역에 복사하고, 이 영역을 제외한 나머지 객체를 삭제한다..
	- ##### Old 영역
		- 가바지 콜렉터에 의해 관리되는 영역
		- 생명주기가 긴 객체들을 대상으로 한다.
		- 여기서 일어나는 가비지 콜렉트를 Major GC 라고 한다. (속도가 느리다)
		- New/Young Area에서 일정시간 참조되고 있는, 살아남은 객체들이 저장되는 공간이다.
___
# JDK (Java Development Kit)
- Java를 사용하기 위해 필요한 모든 기능을 갖춘 Java용 SDK(Software Development Kit)이다.
- JDK는 JRE, javac, jdb, javadoc같은 도구들이 있다.
- JDK는 프로그램을 ==생성, 실행, 컴파일==할 수 있다.
___
# JRE (Java Runtime Environment)
- JVM + 자바 클래스 라이브러리 등으로 구성되어 있다.
- 컴파일 된 Java 프로그램을 ==실행==하는데 필요한 패키지이다.
---
[doozi (2021.05) JVM이란? 개념 및 구조 (JDK, JRE, JIT, 가비지 콜렉터...)](https://doozi0316.tistory.com/entry/1%EC%A3%BC%EC%B0%A8-JVM%EC%9D%80-%EB%AC%B4%EC%97%87%EC%9D%B4%EB%A9%B0-%EC%9E%90%EB%B0%94-%EC%BD%94%EB%93%9C%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%8B%A4%ED%96%89%ED%95%98%EB%8A%94-%EA%B2%83%EC%9D%B8%EA%B0%80)